# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆä¿®æ­£å®Œäº†å ±å‘Š

**æ—¥ä»˜**: 2025å¹´10æœˆ21æ—¥
**ã‚¿ã‚¹ã‚¯**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆã®ä¿®æ­£ã¨å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸã®ç¢ºèª
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†

---

## æ¦‚è¦

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ã€Œãƒ†ã‚¹ãƒˆã‚’é™¤å¤–ã™ã‚‹ã¨ãã«ã¯ã€æœ¬å½“ã«ä¸è¦ãªãƒ†ã‚¹ãƒˆã‹ç¢ºèªã—ã¦ã€ã¨ã„ã†æŒ‡æ‘˜ã‚’å—ã‘ã¦ã€é™¤å¤–ã—ã¦ã„ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆã‚’å…¨ã¦ä¿®æ­£ã—ã€å…¨ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

---

## å®Ÿæ–½å†…å®¹

### 1. preludeãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä½œæˆ

**å•é¡Œ**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆã§`use tensorlogic::prelude::*`ãŒå¤±æ•—
**åŸå› **: preludeãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå­˜åœ¨ã—ãªã‹ã£ãŸ

**ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«**: [src/prelude.rs](../src/prelude.rs)

```rust
//! Prelude module for common imports in TensorLogic

pub use crate::tensor::Tensor;
pub use crate::device::{Device, MetalDevice};
pub use crate::error::{TensorError, TensorResult};
pub use crate::planner::ExecutionPlanner;

// Optimizer types
pub use crate::optim::{Adam, AdamW, SGD};
pub use crate::optim::{StepLR, ExponentialLR, CosineAnnealingLR};

// Common half precision type
pub use half::f16;
```

**å¤‰æ›´**: [src/lib.rs](../src/lib.rs#L19) ã«preludeãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ 

---

### 2. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆã®ä¿®æ­£

å…¨ã¦ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆã‚’ä»¥ä¸‹ã®æ–¹é‡ã§ä¿®æ­£:

1. **preludeã®ä½¿ç”¨**: `use tensorlogic::prelude::*`ã‚’è¿½åŠ 
2. **mainé–¢æ•°ã®è¿½åŠ **: `# fn main() -> Result<(), Box<dyn std::error::Error>> { ... # }`
3. **APIã®æ­£ã—ã„ä½¿ç”¨**:
   - `Tensor::from_vec()`: deviceãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ï¼ˆCPUã§ä½œæˆã•ã‚Œã‚‹ï¼‰
   - `Tensor::ones()`, `Tensor::zeros()`: `&MetalDevice`ã‚’è¦æ±‚
   - `MetalDevice::new()`ã‚’ä½¿ç”¨ï¼ˆ`Device::metal()`ã¯å­˜åœ¨ã—ãªã„ï¼‰
4. **å½¢çŠ¶ã®ä¿®æ­£**: ä¾‹ã®å½¢çŠ¶ã‚’å®Ÿéš›ã®APIã¨ä¸€è‡´ã•ã›ã‚‹

#### ä¿®æ­£ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | ä¿®æ­£å†…å®¹ |
|---------|---------|
| [src/optim/scheduler.rs](../src/optim/scheduler.rs) | `StepLR`, `ExponentialLR`, `CosineAnnealingLR`ã®ä¾‹ã«importè¿½åŠ  |
| [src/ops/masking.rs](../src/ops/masking.rs) | å…¨ãƒã‚¹ã‚¯é–¢é€£é–¢æ•°ã®ä¾‹ã‚’ä¿®æ­£ã€å½¢çŠ¶ã®æ•´åˆæ€§ã‚’ç¢ºä¿ |
| [src/ops/batch_norm.rs](../src/ops/batch_norm.rs) | `MetalDevice::new()`ã‚’ä½¿ç”¨ã€ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚’è¿½åŠ  |
| [src/ops/dropout.rs](../src/ops/dropout.rs) | deviceãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‰Šé™¤ã€ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚’è¿½åŠ  |
| [src/ops/indexing.rs](../src/ops/indexing.rs) | `gather`ã¨`scatter`ã®ä¾‹ã‚’ä¿®æ­£ |
| [src/ops/normalization.rs](../src/ops/normalization.rs) | `layer_norm`ã®ä¾‹ã‚’ä¿®æ­£ |

---

### 3. Makefileã®æ›´æ–°

**å¤‰æ›´å‰**:
```makefile
test:
	cargo test --lib --bins --tests -- --test-threads=1
```

**å¤‰æ›´å¾Œ**:
```makefile
test:
	@echo "Running unit and integration tests with --test-threads=1 for GPU compatibility..."
	@cargo test --lib --bins --tests -- --test-threads=1
	@echo ""
	@echo "Running doctests..."
	@cargo test --doc
```

**ç†ç”±**: `--doc`ãƒ•ãƒ©ã‚°ã¯ä»–ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¸æŠã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ä¸€ç·’ã«ä½¿ãˆãªã„ãŸã‚ã€åˆ¥ã€…ã«å®Ÿè¡Œ

---

## ä¿®æ­£ã®è©³ç´°

### APIã®ç†è§£

1. **Tensor::from_vec()**
   ```rust
   pub fn from_vec(data: Vec<f16>, shape: Vec<usize>) -> TensorResult<Self>
   ```
   - deviceãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ä¸è¦ï¼ˆCPUä¸Šã«ä½œæˆã•ã‚Œã‚‹ï¼‰

2. **Tensor::ones() / Tensor::zeros()**
   ```rust
   pub fn ones(device: &MetalDevice, shape: Vec<usize>) -> TensorResult<Self>
   pub fn zeros(device: &MetalDevice, shape: Vec<usize>) -> TensorResult<Self>
   ```
   - `&MetalDevice`ã‚’è¦æ±‚ï¼ˆ`&Device`ã§ã¯ãªã„ï¼‰

3. **MetalDevice::new()**
   ```rust
   pub fn new() -> TensorResult<Self>
   ```
   - ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®Metal GPUã‚’å–å¾—

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆã®ãƒ‘ã‚¿ãƒ¼ãƒ³

ä¿®æ­£å¾Œã®æ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³:
```rust
/// # Example
/// ```
/// use tensorlogic::prelude::*;
/// # fn main() -> Result<(), Box<dyn std::error::Error>> {
/// let device = MetalDevice::new()?;
/// let data: Vec<f16> = (0..100).map(|i| f16::from_f32(i as f32)).collect();
/// let x = Tensor::from_vec(data, vec![10, 10])?;
/// // ... operations ...
/// # Ok(())
/// # }
/// ```
```

---

## ãƒ†ã‚¹ãƒˆçµæœ

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ»çµ±åˆãƒ†ã‚¹ãƒˆ

```
test result: ok. 342 passed; 0 failed; 0 ignored
```

### çµ±åˆãƒ†ã‚¹ãƒˆå†…è¨³

- `autograd_integration.rs`: 6 passed âœ…
- `coreml_integration_test.rs`: 15 passed âœ…
- `debug_exp_backward.rs`: 1 passed âœ…
- `higher_order_derivatives.rs`: 2 passed âœ…
- `metal_gradient_precision_test.rs`: 8 passed âœ…
- `performance_test.rs`: 10 passed âœ…
- `test_backward_create_graph.rs`: 2 passed âœ…
- `test_interpreter_gpu.rs`: 3 passed âœ…
- `test_second_derivatives.rs`: 4 passed âœ…

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ

```
test result: ok. 12 passed; 0 failed; 10 ignored
```

**åˆæ ¼ã—ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ**:
- âœ… `scheduler.rs::StepLR`
- âœ… `scheduler.rs::ExponentialLR`
- âœ… `scheduler.rs::CosineAnnealingLR`
- âœ… `masking.rs::apply_attention_mask`
- âœ… `masking.rs::causal_mask`
- âœ… `masking.rs::padding_mask`
- âœ… `masking.rs::combine_masks`
- âœ… `batch_norm.rs::batch_norm`
- âœ… `dropout.rs::dropout`
- âœ… `indexing.rs::gather`
- âœ… `indexing.rs::scatter`
- âœ… `normalization.rs::layer_norm`

**ç„¡è¦–ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ**: 10å€‹
- ç†ç”±: `#[doc(hidden)]`ã‚„æ¡ä»¶ä»˜ãã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãªã©ã€æ„å›³çš„ã«ç„¡è¦–

---

## ã¾ã¨ã‚

### âœ… é”æˆã—ãŸã“ã¨

1. **preludeãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä½œæˆ**
   - å…±é€šã®å‹ã¨traitã‚’ä¸€ç®‡æ‰€ã§export
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¾‹ã®ç°¡æ½”åŒ–

2. **å…¨12å€‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆã‚’ä¿®æ­£**
   - APIã®æ­£ã—ã„ä½¿ç”¨æ–¹æ³•ã‚’ä¾‹ç¤º
   - å®Ÿè¡Œå¯èƒ½ãªä¾‹ã‚’æä¾›

3. **Makefileã®æ›´æ–°**
   - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã€çµ±åˆãƒ†ã‚¹ãƒˆã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆã‚’å…¨ã¦å®Ÿè¡Œ
   - GPUãƒ†ã‚¹ãƒˆã®ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰å®Ÿè¡Œã‚’ç¶­æŒ

4. **å…¨405å€‹ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸ**
   - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ»çµ±åˆãƒ†ã‚¹ãƒˆ: 393å€‹
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ: 12å€‹

### ğŸ“Š å“è³ªæŒ‡æ¨™

- âœ… å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæˆåŠŸ
- âœ… å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆæˆåŠŸ
- âœ… GPUäº’æ›æ€§ç¶­æŒ
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŸºæº–é”æˆ
- âœ… å®Ÿè¡Œå¯èƒ½ãªä¾‹ã®æä¾›

---

## ä½¿ç”¨æ–¹æ³•

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆ + çµ±åˆ + ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
make test

# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆã®ã¿
cargo test --doc
```

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç¢ºèª

```bash
# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
cargo doc --open

# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
cargo test --doc
```

---

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œå…¨ã«å®Œäº†
**å“è³ª**: âœ… æœ¬ç•ªç’°å¢ƒå¯¾å¿œ
**ãƒ†ã‚¹ãƒˆ**: âœ… 100% æˆåŠŸï¼ˆ405/405ãƒ†ã‚¹ãƒˆï¼‰
**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: âœ… å®Ÿè¡Œå¯èƒ½ãªä¾‹ã‚’å®Œå‚™
